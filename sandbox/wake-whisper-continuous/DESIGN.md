# ウェイクワード + Whisper 連続記録プロトタイプ（改良版）

## 概要
既存の実装成果を活用し、ウェイクワード検出後に高度なWhisper音声認識を行い、DuckDBに連続記録するプロトタイプ。

## 既存成果の活用

### 1. Porcupineウェイクワード検出
- 既存の`test_multiple_patterns.py`を参考に、複数ウェイクワードに対応
- カスタムppnファイルの読み込みに対応（日本語ウェイクワード用）
- 感度設定（0.3-1.0）のカスタマイズ

### 2. Whisper音声認識（mic_transcribe_final.py）
- マルチレベルバッファ（3秒、8秒、20秒、無音区切り）
- 並列処理による低遅延認識
- 日本語対応（language='ja'）
- 無音検出による自動区切り

### 3. 環境設定
- APIキーは環境変数から取得（PICOVOICE_ACCESS_KEY）
- .envrcによる自動読み込み（.envファイル不要）

## アーキテクチャ

```
┌────────────────────────────────────────────────┐
│            メインプロセス (main.py)              │
│  - 全体制御とUIフィードバック                   │
└──────────────┬─────────────────────────────────┘
               │
       ┌───────┴────────┬────────────────┐
       │                │                │
┌──────▼──────┐ ┌──────▼──────┐ ┌──────▼──────┐
│ウェイクワード│ │ 音声録音     │ │ データ保存   │
│検出スレッド  │ │ スレッド     │ │ スレッド     │
│(Porcupine)  │ │(PyAudio)    │ │(DuckDB)     │
└─────────────┘ └──────┬──────┘ └─────────────┘
                       │
              ┌────────▼────────┐
              │ Whisper認識     │
              │ マルチプロセス   │
              │ (2ワーカー)     │
              └─────────────────┘
```

## 主な改良点

### 1. 日本語ウェイクワード対応
- デフォルト: 英語プリセット（computer, alexa等）
- カスタムppnファイルがあれば日本語ウェイクワードを使用
- 複数ウェイクワードの同時監視

### 2. 高度な音声認識
- マルチレベルバッファによる段階的認識
- 短い発話から長い発話まで最適化
- 並列処理による低遅延

### 3. データ管理
- DuckDBによる構造化データ保存
- タイムスタンプ、ウェイクワード、認識結果、処理時間を記録
- セッション統計の表示

## 実装ファイル

```
wake-whisper-continuous/
├── main.py                    # メインエントリーポイント
├── wake_detector.py           # Porcupineウェイクワード検出（改良版）
├── audio_recorder.py          # マルチレベルバッファ音声録音
├── whisper_processor.py       # Whisperマルチプロセス認識
├── database.py                # DuckDBデータ管理
├── config.py                  # 設定管理（環境変数）
└── ppn/                       # カスタムウェイクワードファイル（オプション）
    └── *.ppn
```