# Whisper音声認識の検証結果

> **最終更新**: 2025-06-22
> **対象モデル**: OpenAI Whisper (base, small)
> **検証環境**: macOS, Python 3.11, uv環境

## 認識精度の実測データ

### 1. 単語・短文の認識結果

| 入力音声 | base認識結果 | small認識結果 | 備考 |
|---------|------------|-------------|-----|
| あいうえお聞こえますか？ | アイウェアを聞こえますか | あいうえお聞こえますか | smallで改善 |
| Eテレ | いいテレイ | イーテレ | 固有名詞は苦手 |
| ストップ | トップ | ストップ | 短い単語は要注意 |
| 3 | さん | 3 / さん | 数字は文字化される |
| はい、わかりました | はい、わかりました | はい、わかりました | 一般的な表現は高精度 |

### 2. 誤認識パターン

#### よくある誤認識
- 「ご視聴ありがとうございました」（無音時）
- 「字幕制作者」（ノイズ時）
- 「提供」（短い音声時）
- 文の繰り返し（同じフレーズが2-3回）

#### 誤認識の特徴
- compression_ratio > 2.4 の場合に発生
- no_speech_prob < 0.3 の場合に多い
- 短い音声（< 1秒）で頻発

## パフォーマンスデータ

### 1. 処理時間

| 音声長 | モデル | 処理時間 | 速度倍率 | メモリ使用量 |
|-------|--------|---------|---------|------------|
| 2秒 | small | 0.8秒 | 2.5x | 約500MB |
| 5秒 | small | 1.2秒 | 4.2x | 約500MB |
| 15秒 | small | 2.5秒 | 6.0x | 約600MB |
| 60秒 | small | 8.0秒 | 7.5x | 約800MB |

### 2. 音量レベル（RMS）

実測値（マイク入力）:
- 無音時: 50-150
- ささやき声: 200-400
- 通常会話: 400-800
- 大きな声: 800-1500
- 最大値: 約1300

推奨閾値:
- 音声検出: 200-250
- 確実な検出: 300

## ベストプラクティス

### 1. Whisperパラメータ最適化

```python
options = {
    'language': 'ja',
    'fp16': False,  # 精度優先
    'temperature': 0.0,  # 決定的な出力
    'compression_ratio_threshold': 2.0,  # 厳しめ
    'logprob_threshold': -1.0,
    'no_speech_threshold': 0.7,  # 厳しめ
    'condition_on_previous_text': False  # 誤認識の伝播防止
}
```

### 2. 音声バッファリング戦略

#### マルチレベル認識
- **Short (3秒)**: 即座の反応、単語レベル
- **Medium (8秒)**: 文単位の認識
- **Long (20秒)**: 文脈考慮した高精度認識
- **Ultra (無音区切り)**: 長い発話の完全認識

#### オーバーラップ設定
- Short: 1秒オーバーラップ
- Medium: 2秒オーバーラップ
- Long: 5秒オーバーラップ

### 3. リアルタイム処理の工夫

1. **マルチプロセス化**
   - 録音と認識を分離
   - ワーカー数: CPUコア数の半分が目安

2. **キューサイズ**
   - maxsize=10 で安定動作
   - Full時は古いデータを破棄

3. **メモリ管理**
   - dequeでリングバッファ実装
   - 最大2分の連続録音バッファ

## 音声エージェントへの応用

### 1. よく使われるコマンドパターン

- **テレビ操作**: 「テレビつけて」「ボリューム上げて/下げて」
- **チャンネル指定**: 「Eテレ」「NHK」などの固有名詞
- **数値指定**: 「3上げて」「10にして」など
- **制御コマンド**: 「ストップ」「スタート」「キャンセル」

### 2. 認識精度向上のための実装

1. **コマンド認識の後処理**
   - 「いいテレイ」→「Eテレ」のような頻出誤認識の自動修正
   - 「さん」→「3」のような数字変換

2. **文脈理解**
   - 「テレビ」「ボリューム」などのキーワードから操作意図を推測
   - 連続した発話から文脈を維持

3. **ユーザーフィードバック**
   - 誤認識パターンを記録し、頻出パターンを学習
   - ユーザー固有の発話パターンへの適応

## まとめ

Whisperは日本語音声認識として実用的なレベル。特に：

✅ **強み**
- オフラインで動作
- カスタマイズ可能
- マルチレベル認識で精度向上
- 無料で商用利用可

❌ **弱み**
- 固有名詞の認識
- 超低遅延は困難
- GPUなしだと重い

💡 **推奨構成**
- モデル: small
- マルチレベル認識
- 音声閾値: 250
- オーバーラップ必須