# 通知ガイドライン

## 作業完了通知について

### 通知タイミング

作業完了通知は以下のタイミングで実行します：

1. **ユーザーが依頼した案件全体が完了したとき**
   - 例：「新機能を実装して」→ 実装・テスト・動作確認がすべて完了した時点
   - 例：「バグを修正して」→ 修正・テスト・動作確認がすべて完了した時点

2. **明示的に通知を求められたとき**
   - ユーザーが「完了したら教えて」と言った場合

### 通知しない場合

以下の場合は通知しません：

- 個別のファイル作成・編集が完了したとき
- 関数やクラスの実装が完了したとき
- 中間的な作業ステップが完了したとき
- エラーが発生して作業を中断したとき

### 通知フォーマット

```bash
say -v Kyoko --rate 220 "[案件名]が完了しました"
```

案件名は以下のように設定：
- ユーザーが明示的に指定した場合：その名前を使用
- 指定がない場合：作業内容を簡潔に要約（例：「設定ファイルの更新」）

## 許可確認通知について

### 通知タイミング

Claude Codeが以下の操作で許可を求めている場合：

- ファイルの読み取り許可
- ファイルの変更許可
- 新規ファイルの作成許可
- ディレクトリへのアクセス許可

### 通知フォーマット

```bash
say -v Kyoko --rate 220 "許可の確認を待っています"
```

この通知は、ユーザーがターミナルを見ていない可能性がある場合の注意喚起として機能します。

## 実用的な通知Tips

### 1Password承認待ち通知

#### 通知タイミング

git commit時に1Passwordの署名承認が必要な場合、以下の状況で通知を行います：

- **1分以上応答がない場合**：ユーザーが1Passwordのポップアップに気づいていない可能性があるため

#### 実装例

```bash
# git commit実行後、1分待ってまだプロセスが終了していない場合に通知
timeout 60 git commit -m "コミットメッセージ" || \
  (say -v Kyoko --rate 220 "1Passwordの承認を待っています" && git commit -m "コミットメッセージ")
```

#### なぜ1分待つのか

- 通常のgit commit操作は数秒で完了します
- 1分以上かかる場合は、ほぼ確実に1Passwordの承認待ちです
- 早すぎる通知は煩わしいため、適度な待機時間を設けています

### その他の長時間処理での通知

#### 大規模なビルド処理

```bash
# 5分以上かかるビルド処理の場合
(npm run build && say -v Kyoko --rate 220 "ビルドが完了しました") || \
  say -v Kyoko --rate 220 "ビルドでエラーが発生しました"
```

#### テストスイートの実行

```bash
# テスト完了時に結果を通知
pytest && say -v Kyoko --rate 220 "すべてのテストが成功しました" || \
  say -v Kyoko --rate 220 "テストが失敗しました"
```

#### 依存関係のインストール

```bash
# 大量の依存関係をインストールする場合
uv sync && say -v Kyoko --rate 220 "依存関係のインストールが完了しました"
```

### 通知を活用するベストプラクティス

1. **長時間処理には必ず通知を設定**
   - 3分以上かかる可能性がある処理には通知を追加

2. **エラー時の通知も忘れずに**
   - 成功時だけでなく、失敗時の通知も重要

3. **通知内容は具体的に**
   - 「完了しました」だけでなく、何が完了したかを明確に

4. **音声レートは環境に合わせて調整**
   - 静かな環境：--rate 200
   - 通常の環境：--rate 220
   - 騒がしい環境：--rate 250