# 作業日誌: Git Worktree未使用による事故と改善

日時: 2025-06-25 20:15
作業者: Claude

## 発生した事故

### 事故の概要
mainブランチで直接作業してコミットしたが、他のエージェントの操作により**コミットが消失**する事故が発生。

### 経緯
1. 開発ガイドラインでGit Worktreeの使用が推奨されていたにも関わらず、確認を怠った
2. mainブランチで`sandbox/wake-whisper-continuous`の開発を実施
3. コミット（154b663）を作成
4. 他のエージェントがmainブランチをリセット
5. コミットが消失（reflogには残っていたが、HEADから切り離された）

### 影響
- 幸い、ファイルはuntracked状態で残っていたため復旧可能だった
- 貴重な「オッケーセバス」ppnファイルが危うく失われるところだった

## 根本原因

1. **ドキュメントの視認性不足**
   - CLAUDE.mdにWorktree使用の指示があったが、目立たない位置だった
   - 「推奨」という表現で、「必須」であることが伝わらなかった

2. **複数エージェント協働の特殊性**
   - 通常の開発と異なり、予告なくmainブランチが変更される
   - この特殊な状況の危険性が十分に伝わっていなかった

## 実施した改善

### 1. CLAUDE.mdの改善
- 冒頭に「🚨 最重要事項」セクションを追加
- mainブランチでの作業を「厳禁」と明記
- 具体的な事故例を記載

### 2. git-workflow.mdの改善
- 最重要ルールとして冒頭に配置
- 実際の事故発生日を明記
- 「必須」であることを強調

### 3. 作業手順の明確化
- 作業開始時の最初のコマンドとして記載
- ステップバイステップの手順を提供

## 学んだこと

1. **重要な指示は最も目立つ場所に**
   - ドキュメントの最初に配置
   - 視覚的に目立つ記号（🚨）を使用
   - 「推奨」ではなく「必須」「厳禁」などの強い言葉を使用

2. **具体的な事故例の重要性**
   - 「なぜ重要か」を具体的な事故例で説明
   - 日付を含めることで現実感を持たせる

3. **複数エージェント協働の特殊性を明記**
   - 通常の開発フローとの違いを強調
   - 予期しない変更が起こりうることを警告

## 今後の対策

- 新しいエージェントが作業を開始する際は、必ず最初にWorktreeを作成
- mainブランチでの作業を検出したら即座に警告
- 定期的にドキュメントの効果を確認し、必要に応じて改善